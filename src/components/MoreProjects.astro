---
import { getCollection } from 'astro:content';
const { currentSlug } = Astro.props;
const projects = await getCollection('projects');
const moreProjects = projects
  .filter(p => p.slug !== currentSlug)
  .sort((a, b) => new Date(b.data.pubDate) - new Date(a.data.pubDate))
  .slice(0, 3);
function getImageUrl(img) {
  if (!img) return '';
  if (typeof img === 'string') return img.startsWith('/') ? img : '/assets/' + img.replace(/^@assets\//, '');
  if (typeof img === 'object' && img.src) return img.src;
  return '';
}
---

<section style="margin-top: 3em;">
  <h2>Xem thÃªm</h2>
  <div style="
    display: flex; 
    flex-wrap: nowrap; 
    gap: 2.5em; 
    justify-content: space-between; 
    align-items: stretch;
    max-width: 100%;
    width: 100%;
  ">
    {moreProjects.map(project => (
      <a href={`/projects/${project.slug}/`} style="
        background: none;
        text-decoration: none;
        color: var(--color-text);
        flex: 1;
        min-width: 0;
        display: flex;
        flex-direction: column;
        align-items: center;
        font-family: system-ui, Inter, Arial, sans-serif;
      ">
        {project.data.featuredImage && (
          <img src={getImageUrl(project.data.featuredImage)} alt={project.data.title} style="
            width: 100%;
            height: 280px;
            object-fit: cover;
            margin-bottom: 1em;
          "/>
        )}
        <div style="width: 100%; text-align: left;">
          <div style="font-size: 1.25em; font-weight:500; margin-bottom:0.2em; line-height:1.1; font-family:inherit;">
            {project.data.title}
          </div>
          <div style="font-size: 0.875em; opacity:0.7; margin-top:0.2em; font-family:inherit;">
            {project.data.employer || 'Dat Nguyen'}
          </div>
        </div>
      </a>
    ))}
  </div>
</section> 